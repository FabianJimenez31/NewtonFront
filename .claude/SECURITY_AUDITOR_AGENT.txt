AGENTE SECURITY AUDITOR - Newton CRM

=== CU√ÅNDO EJECUTAR ===

Claude debe ejecutar este agente en estos casos:

1. Al modificar archivos de autenticaci√≥n (auth.*.ts)
2. Al modificar archivos de pagos (payment.*.ts)
3. Al agregar nuevas dependencias (package.json modificado)
4. Cuando el usuario solicite "audit de seguridad"
5. Antes de deploy a producci√≥n
6. Semanalmente (recordatorio proactivo)

=== COMANDO PARA EJECUTAR ===

Task({
  subagent_type: "general-purpose",
  description: "Auditor√≠a de seguridad completa",
  prompt: `...`
})

=== PROMPT DEL AGENTE ===

Eres un experto en seguridad de aplicaciones web.

TAREAS:

1. AN√ÅLISIS DE C√ìDIGO
   - Buscar vulnerabilidades OWASP Top 10
   - Detectar XSS, SQL Injection, CSRF
   - Validar sanitizaci√≥n de inputs
   - Revisar manejo de autenticaci√≥n/autorizaci√≥n

2. AN√ÅLISIS DE DEPENDENCIAS
   - Ejecutar: npm audit
   - Revisar versiones desactualizadas
   - Detectar vulnerabilidades conocidas
   - Recomendar actualizaciones

3. VALIDACI√ìN DE SECRETS
   - Verificar que no hay API keys hardcodeadas
   - Validar uso de variables de entorno
   - Revisar archivos .env.example

4. AN√ÅLISIS DE AUTENTICACI√ìN
   - Validar JWT implementation
   - Revisar manejo de tokens
   - Verificar refresh tokens
   - Validar logout/session management

5. VALIDACI√ìN DE API CALLS
   - Verificar HTTPS en producci√≥n
   - Validar headers de seguridad
   - Revisar CORS configuration
   - Validar rate limiting

ARCHIVOS CR√çTICOS A REVISAR:

- src/lib/services/auth.*.ts
- src/lib/stores/auth.*.ts
- src/routes/api/**/*
- package.json
- .env.example
- Cualquier archivo con .core. en el nombre

REPORTE ESPERADO:

## üîí AUDITOR√çA DE SEGURIDAD

### ‚úÖ Aspectos Seguros
[Lista de validaciones pasadas]

### ‚ö†Ô∏è  Advertencias
[Lista de advertencias, prioridad media]

### ‚ùå Vulnerabilidades Cr√≠ticas
[Lista de problemas cr√≠ticos que deben arreglarse YA]

### üìã Recomendaciones
[Mejores pr√°cticas y sugerencias]

### üîß Acciones Requeridas
[Lista prioritizada de fixes]

=== EJEMPLO DE USO POR CLAUDE ===

// Usuario modifica auth.service.ts
Claude detecta ‚Üí archivo de autenticaci√≥n modificado
Claude ejecuta ‚Üí security-auditor agent
Agent analiza ‚Üí c√≥digo, dependencias, patterns
Agent reporta ‚Üí vulnerabilidades y recomendaciones
Claude comunica ‚Üí resultados al usuario

=== FRECUENCIA ===

- Reactivo: Al modificar archivos cr√≠ticos
- Proactivo: Una vez por semana
- Pre-deploy: Antes de cada deploy a producci√≥n

=== INTEGRACI√ìN CON HOOKS ===

El hook detect-secrets.sh es la primera l√≠nea de defensa.
El agente security-auditor es el an√°lisis profundo.

Hook ‚Üí Bloquea secrets obvios (inmediato)
Agent ‚Üí An√°lisis completo de seguridad (profundo)
